#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-push verification..."

# Check if there are any uncommitted changes to source files
echo "ğŸ” Checking for uncommitted changes..."
if ! git diff --quiet HEAD -- packages/editor/lang/ packages/webapp/lang/; then
  echo "âŒ ERROR: Uncommitted changes detected in language files!"
  echo "Please commit your language file changes before pushing."
  exit 1
fi

echo "ğŸ“ Compiling i18n resources..."
cd packages/editor && yarn i18n:compile && cd ../webapp && yarn i18n:compile && cd ../..

# Check if compilation created any new files or modified existing ones
echo "ğŸ” Checking if compilation created new files..."
if ! git diff --quiet HEAD -- packages/editor/lang/ packages/webapp/lang/; then
  echo "âŒ ERROR: i18n compilation created/modified files!"
  echo "This indicates that source language files were modified but not committed."
  echo "Please commit your language file changes and run 'yarn i18n:compile' locally."
  exit 1
fi

echo "âœ… i18n compilation completed - no new files created"
echo "ğŸ” Running lint checks..."
yarn lint
echo "ğŸ§ª Running tests..."
yarn test
echo "âœ… All pre-push checks passed!"
